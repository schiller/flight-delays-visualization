}
View(gathered_delay_ratios)
rm(list = ls())
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
library(tidyr)
library(dplyr)
library(ggplot2)
# setwd(dir = "../DataScience/udacity-nanodegree-data-analyst/P6 - Make Effective Data Visualization/final-project/data/")
# setwd(dir = "../../OneDrive/DataScience/udacity-nanodegree-data-analyst/P6 - Make Effective Data Visualization/final-project/data/")
# delays <- read.csv(file = "2003_06_2017_01_airline_delay_causes.csv")
delays <- read.csv(file = "2016_airline_delay_causes.csv")
colnames(delays)[c(2, 10, 16, 17)] <-
c("month", "weather_ct", "arr_delay", "carrier_delay")
delays$X <- NULL
delays[is.na(delays)] <- 0
delays$date <- with(delays,
as.Date(paste(year, month, '01'), format = "%Y %m %d"))
delays$arr_on_time <- with(delays,
arr_flights - arr_del15 - arr_cancelled -
arr_diverted)
delays_sum <- delays %>%
group_by(carrier_name, year, month) %>%
summarise(delays = sum(arr_del15)) %>%
ungroup() %>%
ungroup()
delays_sum$date <- with(delays_sum,
as.Date(paste(year, month, '01'), format = "%Y %m %d"))
ggplot(data = delays_sum, mapping = aes(x = date, y = delays)) +
geom_line(mapping = aes(color = carrier_name))
delays_avg <- delays %>%
group_by(carrier_name, year, month) %>%
summarise(delays = sum(arr_del15)/sum(arr_flights)) %>%
ungroup() %>%
ungroup()
delays_avg$date <- with(delays_avg,
as.Date(paste(year, month, '01'), format = "%Y %m %d"))
ggplot(data = delays_avg, mapping = aes(x = date, y = delays)) +
geom_line(mapping = aes(color = carrier_name))
ggplot(data = delays_avg, mapping = aes(x = date)) +
geom_col(mapping = aes(fill = carrier_name, y = delays))
delay_sums <- delays %>%
group_by(carrier_name, month) %>%
summarise(arr_flights = sum(arr_flights),
arr_on_time = sum(arr_on_time),
arr_del15 = sum(arr_del15),
arr_cancelled = sum(arr_cancelled),
arr_diverted = sum(arr_diverted),
carrier_ct = sum(carrier_ct),
weather_ct = sum(weather_ct),
nas_ct = sum(nas_ct),
security_ct = sum(security_ct),
late_aircraft_ct = sum(late_aircraft_ct)) %>%
ungroup()
delay_ratios <- delays %>%
group_by(carrier_name, month) %>%
summarise(
# on_time_ratio = sum(arr_on_time) / sum(arr_flights),
# del15_ratio = sum(arr_del15 / sum(arr_flights)),
cancelled_ratio = sum(arr_cancelled / sum(arr_flights)),
diverted_ratio = sum(arr_diverted / sum(arr_flights)),
carrier_ratio = sum(carrier_ct / sum(arr_flights)),
weather_ratio = sum(weather_ct / sum(arr_flights)),
nas_ratio = sum(nas_ct / sum(arr_flights)),
security_ratio = sum(security_ct / sum(arr_flights)),
late_aircraft_ratio = sum(late_aircraft_ct) / sum(arr_flights)) %>%
ungroup()
gathered_delay_ratios <- delay_ratios %>%
gather(key = status, value = ratio, 3:9)
gathered_delay_ratios$date <- with(gathered_delay_ratios,
as.Date(paste('2016', month, '01'),
format = "%Y %m %d"))
gathered_delay_ratios$status <- as.factor(gathered_delay_ratios$status)
gathered_delay_ratios$status <- with(gathered_delay_ratios,
reorder(status, ratio))
for(carrier in levels(gathered_delay_ratios$carrier_name)) {
print(ggplot(subset(gathered_delay_ratios, carrier_name == carrier),
aes(x = date, y = ratio, fill = status)) +
geom_col())
}
View(gathered_delay_ratios)
ggplot(subset(gathered_delay_ratios, carrier_name == "Alaska Airlines Inc."),
aes(x = date, y = ratio, fill = status)) +
geom_area()
write.csv(x = gathered_delay_ratios, file = "2016_delays.csv")
write.csv(x = subset(gathered_delay_ratios,
carrier_name == "Alaska Airlines Inc."),
file = "2016_delays.csv")
write.csv(x = subset(gathered_delay_ratios,
carrier_name == "Alaska Airlines Inc."),
file = "2016_delays_alaska.csv")
write.csv(x = gathered_delay_ratios, file = "2016_delays.csv")
View(gathered_delay_ratios)
View(delay_sums)
delay_totals <- delays %>%
group_by(carrier_name) %>%
summarise(arr_flights = sum(arr_flights))
write.csv(x = delay_totals, file = "2016_delay_totals.csv")
ggplot(data = delays_avg, mapping = aes(x = date, y = delays)) +
geom_line(mapping = aes(color = carrier_name))
ggplot(data = delays_avg, mapping = aes(x = date)) +
geom_col(mapping = aes(fill = carrier_name, y = delays))
rm(ls())
rm(list = ls())
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
library(tidyr)
library(dplyr)
library(ggplot2)
# setwd(dir = "../DataScience/udacity-nanodegree-data-analyst/P6 - Make Effective Data Visualization/final-project/data/")
# setwd(dir = "../../OneDrive/DataScience/udacity-nanodegree-data-analyst/P6 - Make Effective Data Visualization/final-project/data/")
# delays <- read.csv(file = "2003_06_2017_01_airline_delay_causes.csv")
delays <- read.csv(file = "2016_airline_delay_causes.csv")
colnames(delays)[c(2, 10, 16, 17)] <-
c("month", "weather_ct", "arr_delay", "carrier_delay")
delays$X <- NULL
delays[is.na(delays)] <- 0
delays$date <- with(delays,
as.Date(paste(year, month, '01'), format = "%Y %m %d"))
delays$arr_on_time <- with(delays,
arr_flights - arr_del15 - arr_cancelled -
arr_diverted)
delay_sums <- delays %>%
group_by(carrier_name, month) %>%
summarise(arr_flights = sum(arr_flights),
arr_on_time = sum(arr_on_time),
arr_del15 = sum(arr_del15),
arr_cancelled = sum(arr_cancelled),
arr_diverted = sum(arr_diverted),
carrier_ct = sum(carrier_ct),
weather_ct = sum(weather_ct),
nas_ct = sum(nas_ct),
security_ct = sum(security_ct),
late_aircraft_ct = sum(late_aircraft_ct)) %>%
ungroup()
delay_ratios <- delays %>%
group_by(carrier_name, month) %>%
summarise(
# on_time_ratio = sum(arr_on_time) / sum(arr_flights),
# del15_ratio = sum(arr_del15 / sum(arr_flights)),
cancelled_ratio = sum(arr_cancelled / sum(arr_flights)),
diverted_ratio = sum(arr_diverted / sum(arr_flights)),
carrier_ratio = sum(carrier_ct / sum(arr_flights)),
weather_ratio = sum(weather_ct / sum(arr_flights)),
nas_ratio = sum(nas_ct / sum(arr_flights)),
security_ratio = sum(security_ct / sum(arr_flights)),
late_aircraft_ratio = sum(late_aircraft_ct) / sum(arr_flights)) %>%
ungroup()
gathered_delay_ratios <- delay_ratios %>%
gather(key = status, value = ratio, 3:9)
gathered_delay_ratios$date <- with(gathered_delay_ratios,
as.Date(paste('2016', month, '01'),
format = "%Y %m %d"))
gathered_delay_ratios$status <- as.factor(gathered_delay_ratios$status)
gathered_delay_ratios$status <- with(gathered_delay_ratios,
reorder(status, ratio))
for(carrier in levels(gathered_delay_ratios$carrier_name)) {
print(ggplot(subset(gathered_delay_ratios, carrier_name == carrier),
aes(x = date, y = ratio, fill = status)) +
geom_col())
}
ggplot(subset(gathered_delay_ratios, carrier_name == "Alaska Airlines Inc."),
aes(x = date, y = ratio, fill = status)) +
geom_area()
delay_totals <- delays %>%
group_by(carrier_name) %>%
summarise(arr_flights = sum(arr_flights))
write.csv(x = subset(gathered_delay_ratios,
carrier_name == "Alaska Airlines Inc."),
file = "2016_delays_alaska.csv")
write.csv(x = gathered_delay_ratios, file = "2016_delays.csv")
write.csv(x = delay_totals, file = "2016_delay_totals.csv")
delay_totals <- delays %>%
group_by(carrier_name) %>%
summarise(arr_flights = sum(arr_flights),
arr_on_time = sum(arr_on_time))
write.csv(x = delay_totals, file = "2016_delay_totals.csv")
delay_totals <- delays %>%
group_by(carrier_name) %>%
summarise(arr_flights = sum(arr_flights),
on_time_ratio = sum(arr_on_time) / sum(arr_flights))
write.csv(x = delay_totals, file = "2016_delay_totals.csv")
delay_stats <- delays %>%
group_by(carrier_name, month) %>%
summarise(arr_on_time = sum(arr_on_time),
arr_del15 = sum(arr_del15),
arr_cancelled = sum(arr_cancelled),
arr_diverted = sum(arr_diverted),
carrier_ct = sum(carrier_ct),
weather_ct = sum(weather_ct),
nas_ct = sum(nas_ct),
security_ct = sum(security_ct),
late_aircraft_ct = sum(late_aircraft_ct),
on_time_ratio = sum(arr_on_time) / sum(arr_flights),
del15_ratio = sum(arr_del15 / sum(arr_flights)),
cancelled_ratio = sum(arr_cancelled / sum(arr_flights)),
diverted_ratio = sum(arr_diverted / sum(arr_flights)),
carrier_ratio = sum(carrier_ct / sum(arr_flights)),
weather_ratio = sum(weather_ct / sum(arr_flights)),
nas_ratio = sum(nas_ct / sum(arr_flights)),
security_ratio = sum(security_ct / sum(arr_flights)),
late_aircraft_ratio = sum(late_aircraft_ct) / sum(arr_flights)) %>%
ungroup()
rm(list = ls())
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
library(tidyr)
library(dplyr)
library(ggplot2)
# setwd(dir = "../DataScience/udacity-nanodegree-data-analyst/P6 - Make Effective Data Visualization/final-project/data/")
# setwd(dir = "../../OneDrive/DataScience/udacity-nanodegree-data-analyst/P6 - Make Effective Data Visualization/final-project/data/")
# delays <- read.csv(file = "2003_06_2017_01_airline_delay_causes.csv")
delays <- read.csv(file = "2016_airline_delay_causes.csv")
colnames(delays)[c(2, 10, 16, 17)] <-
c("month", "weather_ct", "arr_delay", "carrier_delay")
delays$X <- NULL
delays[is.na(delays)] <- 0
delays$date <- with(delays,
as.Date(paste(year, month, '01'), format = "%Y %m %d"))
delays$arr_on_time <- with(delays,
arr_flights - arr_del15 - arr_cancelled -
arr_diverted)
delay_stats <- delays %>%
group_by(carrier_name, month) %>%
summarise(arr_on_time = sum(arr_on_time),
arr_del15 = sum(arr_del15),
arr_cancelled = sum(arr_cancelled),
arr_diverted = sum(arr_diverted),
carrier_ct = sum(carrier_ct),
weather_ct = sum(weather_ct),
nas_ct = sum(nas_ct),
security_ct = sum(security_ct),
late_aircraft_ct = sum(late_aircraft_ct),
on_time_ratio = sum(arr_on_time) / sum(arr_flights),
del15_ratio = sum(arr_del15 / sum(arr_flights)),
cancelled_ratio = sum(arr_cancelled / sum(arr_flights)),
diverted_ratio = sum(arr_diverted / sum(arr_flights)),
carrier_ratio = sum(carrier_ct / sum(arr_flights)),
weather_ratio = sum(weather_ct / sum(arr_flights)),
nas_ratio = sum(nas_ct / sum(arr_flights)),
security_ratio = sum(security_ct / sum(arr_flights)),
late_aircraft_ratio = sum(late_aircraft_ct) / sum(arr_flights)) %>%
ungroup()
delay_ratios <- delays %>%
group_by(carrier_name, month) %>%
summarise(
# on_time_ratio = sum(arr_on_time) / sum(arr_flights),
# del15_ratio = sum(arr_del15 / sum(arr_flights)),
cancelled_ratio = sum(arr_cancelled / sum(arr_flights)),
diverted_ratio = sum(arr_diverted / sum(arr_flights)),
carrier_ratio = sum(carrier_ct / sum(arr_flights)),
weather_ratio = sum(weather_ct / sum(arr_flights)),
nas_ratio = sum(nas_ct / sum(arr_flights)),
security_ratio = sum(security_ct / sum(arr_flights)),
late_aircraft_ratio = sum(late_aircraft_ct) / sum(arr_flights)) %>%
ungroup()
gathered_delay_ratios <- delay_ratios %>%
gather(key = status, value = ratio, 3:9)
gathered_delay_ratios$date <- with(gathered_delay_ratios,
as.Date(paste('2016', month, '01'),
format = "%Y %m %d"))
gathered_delay_ratios$status <- as.factor(gathered_delay_ratios$status)
gathered_delay_ratios$status <- with(gathered_delay_ratios,
reorder(status, ratio))
for(carrier in levels(gathered_delay_ratios$carrier_name)) {
print(ggplot(subset(gathered_delay_ratios, carrier_name == carrier),
aes(x = date, y = ratio, fill = status)) +
geom_col())
}
ggplot(subset(gathered_delay_ratios, carrier_name == "Alaska Airlines Inc."),
aes(x = date, y = ratio, fill = status)) +
geom_area()
delay_totals <- delays %>%
group_by(carrier_name) %>%
summarise(arr_flights = sum(arr_flights),
on_time_ratio = sum(arr_on_time) / sum(arr_flights))
write.csv(x = subset(gathered_delay_ratios,
carrier_name == "Alaska Airlines Inc."),
file = "2016_delays_alaska.csv")
write.csv(x = gathered_delay_ratios, file = "2016_delays.csv")
write.csv(x = delay_totals, file = "2016_delay_totals.csv")
delay_stats <- delays %>%
group_by(carrier_name, month) %>%
summarise(on_time = sum(arr_on_time),
cancelled = sum(arr_cancelled),
diverted = sum(arr_diverted),
carrier = sum(carrier_ct),
weather = sum(weather_ct),
nas = sum(nas_ct),
security = sum(security_ct),
late_aircraft = sum(late_aircraft_ct),
on_time_ratio = sum(arr_on_time) / sum(arr_flights),
cancelled_ratio = sum(arr_cancelled / sum(arr_flights)),
diverted_ratio = sum(arr_diverted / sum(arr_flights)),
carrier_ratio = sum(carrier_ct / sum(arr_flights)),
weather_ratio = sum(weather_ct / sum(arr_flights)),
nas_ratio = sum(nas_ct / sum(arr_flights)),
security_ratio = sum(security_ct / sum(arr_flights)),
late_aircraft_ratio = sum(late_aircraft_ct) / sum(arr_flights)) %>%
ungroup()
delay_sums <- delays %>%
group_by(carrier_name, month) %>%
summarise(on_time = sum(arr_on_time),
cancelled = sum(arr_cancelled),
diverted = sum(arr_diverted),
carrier = sum(carrier_ct),
weather = sum(weather_ct),
nas = sum(nas_ct),
security = sum(security_ct),
late_aircraft = sum(late_aircraft_ct)) %>%
ungroup()
delay_ratios <- delays %>%
group_by(carrier_name, month) %>%
summarise(on_time = sum(arr_on_time) / sum(arr_flights),
cancelled = sum(arr_cancelled / sum(arr_flights)),
diverted = sum(arr_diverted / sum(arr_flights)),
carrier = sum(carrier_ct / sum(arr_flights)),
weather = sum(weather_ct / sum(arr_flights)),
nas = sum(nas_ct / sum(arr_flights)),
security = sum(security_ct / sum(arr_flights)),
late_aircraft = sum(late_aircraft_ct) / sum(arr_flights)) %>%
ungroup()
gathered_delay_sums <- delays %>%
group_by(carrier_name, month) %>%
summarise(on_time = sum(arr_on_time),
cancelled = sum(arr_cancelled),
diverted = sum(arr_diverted),
carrier = sum(carrier_ct),
weather = sum(weather_ct),
nas = sum(nas_ct),
security = sum(security_ct),
late_aircraft = sum(late_aircraft_ct)) %>%
ungroup() %>%
gather(key = status, value = sum, 3:10)
gathered_delay_ratios <- delays %>%
group_by(carrier_name, month) %>%
summarise(on_time = sum(arr_on_time) / sum(arr_flights),
cancelled = sum(arr_cancelled / sum(arr_flights)),
diverted = sum(arr_diverted / sum(arr_flights)),
carrier = sum(carrier_ct / sum(arr_flights)),
weather = sum(weather_ct / sum(arr_flights)),
nas = sum(nas_ct / sum(arr_flights)),
security = sum(security_ct / sum(arr_flights)),
late_aircraft = sum(late_aircraft_ct) / sum(arr_flights)) %>%
ungroup() %>%
gather(key = status, value = ratio, 3:10)
gathered_delay_stats <- left_join(gathered_delay_sums, gathered_delay_ratios,
by = c("carrier_name", "month", "status"))
View(gathered_delay_stats)
gathered_delay_stats <- left_join(gathered_delay_sums, gathered_delay_ratios,
by = c("carrier_name", "month", "status"))
View(gathered_delay_stats)
write.csv(x = subset(gathered_delay_stats,
carrier_name == "Alaska Airlines Inc."),
file = "2016_delays_alaska.csv")
write.csv(x = gathered_delay_stats, file = "2016_delays.csv")
write.csv(x = delay_totals, file = "2016_delay_totals.csv")
View(gathered_delay_stats)
gathered_delay_sums <- delays %>%
group_by(carrier_name, month) %>%
summarise(on_time = sum(arr_on_time),
cancelled = sum(arr_cancelled),
diverted = sum(arr_diverted),
carrier = sum(carrier_ct),
weather = sum(weather_ct),
nas = sum(nas_ct),
security = sum(security_ct),
late_aircraft = sum(late_aircraft_ct)) %>%
ungroup() %>%
gather(key = Status, value = Flights, 3:10)
gathered_delay_ratios <- delays %>%
group_by(carrier_name, month) %>%
summarise(on_time = sum(arr_on_time) / sum(arr_flights),
cancelled = sum(arr_cancelled / sum(arr_flights)),
diverted = sum(arr_diverted / sum(arr_flights)),
carrier = sum(carrier_ct / sum(arr_flights)),
weather = sum(weather_ct / sum(arr_flights)),
nas = sum(nas_ct / sum(arr_flights)),
security = sum(security_ct / sum(arr_flights)),
late_aircraft = sum(late_aircraft_ct) / sum(arr_flights)) %>%
ungroup() %>%
gather(key = Status, value = Ratio, 3:10)
gathered_delay_stats <- left_join(gathered_delay_sums, gathered_delay_ratios,
by = c("carrier_name", "month", "Status"))
gathered_delay_sums <- delays %>%
group_by(carrier_name, month) %>%
summarise(on_time = sum(arr_on_time),
cancelled = sum(arr_cancelled),
diverted = sum(arr_diverted),
carrier = sum(carrier_ct),
weather = sum(weather_ct),
nas = sum(nas_ct),
security = sum(security_ct),
late_aircraft = sum(late_aircraft_ct)) %>%
ungroup() %>%
gather(key = status, value = sum, 3:10)
gathered_delay_ratios <- delays %>%
group_by(carrier_name, month) %>%
summarise(on_time = sum(arr_on_time) / sum(arr_flights),
cancelled = sum(arr_cancelled / sum(arr_flights)),
diverted = sum(arr_diverted / sum(arr_flights)),
carrier = sum(carrier_ct / sum(arr_flights)),
weather = sum(weather_ct / sum(arr_flights)),
nas = sum(nas_ct / sum(arr_flights)),
security = sum(security_ct / sum(arr_flights)),
late_aircraft = sum(late_aircraft_ct) / sum(arr_flights)) %>%
ungroup() %>%
gather(key = status, value = ratio, 3:10)
gathered_delay_stats <- left_join(gathered_delay_sums, gathered_delay_ratios,
by = c("carrier_name", "month", "status"))
colnames(gathered_delay_stats)
colnames(gathered_delay_stats) <- c("carrier_name", "month", "status", "sum", "Ratio")
colnames(gathered_delay_stats) <- c("carrier name", "month", "status", "sum", "Ratio")
colnames(gathered_delay_stats) <- c("Carrier Name", "Month", "Status", "Flights", "Ratio")
gathered_delay_stats <- left_join(gathered_delay_sums, gathered_delay_ratios,
by = c("carrier_name", "month", "status"))
gathered_delay_stats <- left_join(gathered_delay_sums, gathered_delay_ratios,
by = c("carrier_name", "month", "status"))
gathered_delay_stats$status[gathered_delay_stats$status == "on_time"] <- "On Time"
gathered_delay_stats$status[gathered_delay_stats$status == "cancelled"] <- "Cancelled"
gathered_delay_stats$status[gathered_delay_stats$status == "diverted"] <- "Diverted"
gathered_delay_stats$status[gathered_delay_stats$status == "carrier"] <- "Carrier"
gathered_delay_stats$status[gathered_delay_stats$status == "weather"] <- "Weather"
gathered_delay_stats$status[gathered_delay_stats$status == "nas"] <- "NAS"
gathered_delay_stats$status[gathered_delay_stats$status == "security"] <- "Security"
gathered_delay_stats$status[gathered_delay_stats$status == "late_aircraft"] <- "Late Aircraft"
colnames(gathered_delay_stats) <- c("Carrier Name", "Month", "Status", "Flights", "Ratio")
write.csv(x = gathered_delay_stats, file = "2016_delays.csv")
gathered_delay_stats <- left_join(gathered_delay_sums, gathered_delay_ratios,
by = c("carrier_name", "month", "status"))
gathered_delay_stats$status[gathered_delay_stats$status == "on_time"] <- "On Time"
gathered_delay_stats$status[gathered_delay_stats$status == "cancelled"] <- "Cancelled"
gathered_delay_stats$status[gathered_delay_stats$status == "diverted"] <- "Diverted"
gathered_delay_stats$status[gathered_delay_stats$status == "carrier"] <- "Carrier"
gathered_delay_stats$status[gathered_delay_stats$status == "weather"] <- "Weather"
gathered_delay_stats$status[gathered_delay_stats$status == "nas"] <- "NAS"
gathered_delay_stats$status[gathered_delay_stats$status == "security"] <- "Security"
gathered_delay_stats$status[gathered_delay_stats$status == "late_aircraft"] <- "Late Aircraft"
colnames(gathered_delay_stats) <- c("Carrier Name", "Month", "Status", "Flights", "Flights Ratio")
warnings()
rm(list = ls())
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
library(tidyr)
library(dplyr)
library(ggplot2)
# setwd(dir = "../DataScience/udacity-nanodegree-data-analyst/P6 - Make Effective Data Visualization/final-project/data/")
# setwd(dir = "../../OneDrive/DataScience/udacity-nanodegree-data-analyst/P6 - Make Effective Data Visualization/final-project/data/")
# delays <- read.csv(file = "2003_06_2017_01_airline_delay_causes.csv")
delays <- read.csv(file = "2016_airline_delay_causes.csv")
colnames(delays)[c(2, 10, 16, 17)] <-
c("month", "weather_ct", "arr_delay", "carrier_delay")
delays$X <- NULL
delays[is.na(delays)] <- 0
delays$date <- with(delays,
as.Date(paste(year, month, '01'), format = "%Y %m %d"))
delays$arr_on_time <- with(delays,
arr_flights - arr_del15 - arr_cancelled -
arr_diverted)
gathered_delay_sums <- delays %>%
group_by(carrier_name, month) %>%
summarise(on_time = sum(arr_on_time),
cancelled = sum(arr_cancelled),
diverted = sum(arr_diverted),
carrier = sum(carrier_ct),
weather = sum(weather_ct),
nas = sum(nas_ct),
security = sum(security_ct),
late_aircraft = sum(late_aircraft_ct)) %>%
ungroup() %>%
gather(key = status, value = sum, 3:10)
gathered_delay_ratios <- delays %>%
group_by(carrier_name, month) %>%
summarise(on_time = sum(arr_on_time) / sum(arr_flights),
cancelled = sum(arr_cancelled / sum(arr_flights)),
diverted = sum(arr_diverted / sum(arr_flights)),
carrier = sum(carrier_ct / sum(arr_flights)),
weather = sum(weather_ct / sum(arr_flights)),
nas = sum(nas_ct / sum(arr_flights)),
security = sum(security_ct / sum(arr_flights)),
late_aircraft = sum(late_aircraft_ct) / sum(arr_flights)) %>%
ungroup() %>%
gather(key = status, value = ratio, 3:10)
gathered_delay_stats <- left_join(gathered_delay_sums, gathered_delay_ratios,
by = c("carrier_name", "month", "status"))
gathered_delay_stats$status[gathered_delay_stats$status == "on_time"] <- "On Time"
gathered_delay_stats$status[gathered_delay_stats$status == "cancelled"] <- "Cancelled"
gathered_delay_stats$status[gathered_delay_stats$status == "diverted"] <- "Diverted"
gathered_delay_stats$status[gathered_delay_stats$status == "carrier"] <- "Carrier"
gathered_delay_stats$status[gathered_delay_stats$status == "weather"] <- "Weather"
gathered_delay_stats$status[gathered_delay_stats$status == "nas"] <- "NAS"
gathered_delay_stats$status[gathered_delay_stats$status == "security"] <- "Security"
gathered_delay_stats$status[gathered_delay_stats$status == "late_aircraft"] <- "Late Aircraft"
colnames(gathered_delay_stats) <- c("Carrier Name", "Month", "Status", "Flights", "Flights Ratio")
# gathered_delay_ratios$date <- with(gathered_delay_ratios,
#                                    as.Date(paste('2016', month, '01'),
#                                            format = "%Y %m %d"))
#
# gathered_delay_ratios$status <- as.factor(gathered_delay_ratios$status)
#
# gathered_delay_ratios$status <- with(gathered_delay_ratios,
#                                      reorder(status, ratio))
# for(carrier in levels(gathered_delay_ratios$carrier_name)) {
#   print(ggplot(subset(gathered_delay_ratios, carrier_name == carrier),
#                aes(x = date, y = ratio, fill = status)) +
#           geom_col())
# }
# ggplot(subset(gathered_delay_ratios, carrier_name == "Alaska Airlines Inc."),
#        aes(x = date, y = ratio, fill = status)) +
#   geom_area()
delay_totals <- delays %>%
group_by(carrier_name) %>%
summarise(arr_flights = sum(arr_flights),
on_time_ratio = sum(arr_on_time) / sum(arr_flights))
write.csv(x = gathered_delay_stats, file = "2016_delays.csv")
write.csv(x = delay_totals, file = "2016_delay_totals.csv")
